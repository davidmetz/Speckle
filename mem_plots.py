import os
import matplotlib.pyplot as plt
import re
import numpy as np
texts = {
    "RocketZynqConfig.bit" :"""size: 64, time: 2
size: 64, time: 1 adj
size: 128, time: 2
size: 128, time: 1 adj
size: 256, time: 2
size: 256, time: 1 adj
size: 512, time: 2
size: 512, time: 1 adj
size: 1024, time: 2
size: 1024, time: 1 adj
size: 2048, time: 3
size: 2048, time: 2 adj
size: 4096, time: 17
size: 4096, time: 16 adj
size: 8192, time: 25
size: 8192, time: 24 adj
size: 16384, time: 29
size: 16384, time: 28 adj
size: 32768, time: 31
size: 32768, time: 30 adj
size: 65536, time: 32
size: 65536, time: 31 adj
size: 131072, time: 32
size: 131072, time: 31 adj
size: 262144, time: 33
size: 262144, time: 32 adj
size: 524288, time: 33
size: 524288, time: 32 adj
size: 1048576, time: 33
size: 1048576, time: 32 adj
size: 2097152, time: 33
size: 2097152, time: 32 adj
size: 4194304, time: 33
size: 4194304, time: 32 adj
size: 8388608, time: 33
size: 8388608, time: 32 adj""",
    "WithL2TLB_WithL2Cache_With1GbRam_RocketZynqConfig.bit " :"""size: 64, time: 3
size: 64, time: 2 adj
size: 128, time: 2
size: 128, time: 1 adj
size: 256, time: 2
size: 256, time: 1 adj
size: 512, time: 2
size: 512, time: 1 adj
size: 1024, time: 2
size: 1024, time: 1 adj
size: 2048, time: 3
size: 2048, time: 2 adj
size: 4096, time: 10
size: 4096, time: 9 adj
size: 8192, time: 14
size: 8192, time: 13 adj
size: 16384, time: 16
size: 16384, time: 15 adj
size: 32768, time: 17
size: 32768, time: 16 adj
size: 65536, time: 19
size: 65536, time: 18 adj
size: 131072, time: 31
size: 131072, time: 30 adj
size: 262144, time: 38
size: 262144, time: 37 adj
size: 524288, time: 42
size: 524288, time: 41 adj
size: 1048576, time: 44
size: 1048576, time: 43 adj
size: 2097152, time: 45
size: 2097152, time: 44 adj
size: 4194304, time: 45
size: 4194304, time: 44 adj
size: 8388608, time: 45
size: 8388608, time: 44 adj""",
    "WithL2TLB_WithL2Cache_With1GbRam_SmallBoomZynqConfig.bit" :"""size: 64, time: 22
size: 64, time: 8 adj
size: 128, time: 21
size: 128, time: 7 adj
size: 256, time: 21
size: 256, time: 7 adj
size: 512, time: 21
size: 512, time: 7 adj
size: 1024, time: 21
size: 1024, time: 7 adj
size: 2048, time: 22
size: 2048, time: 8 adj
size: 4096, time: 36
size: 4096, time: 22 adj
size: 8192, time: 43
size: 8192, time: 29 adj
size: 16384, time: 47
size: 16384, time: 33 adj
size: 32768, time: 49
size: 32768, time: 35 adj
size: 65536, time: 51
size: 65536, time: 37 adj
size: 131072, time: 66
size: 131072, time: 52 adj
size: 262144, time: 74
size: 262144, time: 60 adj
size: 524288, time: 79
size: 524288, time: 65 adj
size: 1048576, time: 81
size: 1048576, time: 67 adj
size: 2097152, time: 82
size: 2097152, time: 68 adj
size: 4194304, time: 82
size: 4194304, time: 68 adj
size: 8388608, time: 83
size: 8388608, time: 69 adj""",
    "SmallBoomZynqConfig.bit " :"""size: 64, time: 22
size: 64, time: 8 adj
size: 128, time: 21
size: 128, time: 7 adj
size: 256, time: 21
size: 256, time: 7 adj
size: 512, time: 21
size: 512, time: 7 adj
size: 1024, time: 22
size: 1024, time: 8 adj
size: 2048, time: 23
size: 2048, time: 9 adj
size: 4096, time: 43
size: 4096, time: 29 adj
size: 8192, time: 54
size: 8192, time: 40 adj
size: 16384, time: 60
size: 16384, time: 46 adj
size: 32768, time: 63
size: 32768, time: 49 adj
size: 65536, time: 64
size: 65536, time: 50 adj
size: 131072, time: 65
size: 131072, time: 51 adj
size: 262144, time: 65
size: 262144, time: 51 adj
size: 524288, time: 66
size: 524288, time: 52 adj
size: 1048576, time: 66
size: 1048576, time: 52 adj
size: 2097152, time: 66
size: 2097152, time: 52 adj
size: 4194304, time: 66
size: 4194304, time: 52 adj
size: 8388608, time: 66
size: 8388608, time: 52 adj""",
}
fig = plt.figure(figsize=(10,6))
for name, text in texts.items():
    xs = []
    ys = []
    for line in text.split("\n"):
        if "adj" not in line:
            continue
        _, x, _, y, *_ = line.split()
        x = int(x[:-1])
        y = int(y)
        xs.append(x)
        ys.append(y)
    plt.plot(range(len(xs)), ys, label=name)
plt.title("physical memory random access latency")
ax = plt.gca()
ax.set_xticks(range(len(xs)))
ax.set_xticklabels(xs)
plt.xticks(rotation=45)
ax.set_ylabel("cycles")
ax.set_xlabel("64bit words")
plt.legend()
fig.tight_layout()
plt.savefig(f"p_ram_random.png")
plt.show()

texts = {
    "Rocket (16KB L1D)": """cleaning memory...
setting up 32 pointers...
chaseing pointers...
...done - 0x81000168 - 0x81000168
size: 64, cycles: 186, loops: 32, cycles_per_loop: 5
cleaning memory...
setting up 64 pointers...
chaseing pointers...
...done - 0x81000110 - 0x81000110
size: 128, cycles: 203, loops: 64, cycles_per_loop: 3
cleaning memory...
setting up 128 pointers...
chaseing pointers...
...done - 0x81000030 - 0x81000030
size: 256, cycles: 395, loops: 128, cycles_per_loop: 3
cleaning memory...
setting up 256 pointers...
chaseing pointers...
...done - 0x81000960 - 0x81000960
size: 512, cycles: 784, loops: 256, cycles_per_loop: 3
cleaning memory...
setting up 512 pointers...
chaseing pointers...
...done - 0x810017f0 - 0x810017f0
size: 1024, cycles: 1622, loops: 512, cycles_per_loop: 3
cleaning memory...
setting up 1024 pointers...
chaseing pointers...
...done - 0x810020e8 - 0x810020e8
size: 2048, cycles: 5176, loops: 1024, cycles_per_loop: 5
cleaning memory...
setting up 2048 pointers...
chaseing pointers...
...done - 0x810045f0 - 0x810045f0
size: 4096, cycles: 44267, loops: 2048, cycles_per_loop: 21
cleaning memory...
setting up 4096 pointers...
chaseing pointers...
...done - 0x81006af8 - 0x81006af8
size: 8192, cycles: 114585, loops: 4096, cycles_per_loop: 27
cleaning memory...
setting up 8192 pointers...
chaseing pointers...
...done - 0x81015838 - 0x81015838
size: 16384, cycles: 255885, loops: 8192, cycles_per_loop: 31
cleaning memory...
setting up 16384 pointers...
chaseing pointers...
...done - 0x8100a360 - 0x8100a360
size: 32768, cycles: 532958, loops: 16384, cycles_per_loop: 32
cleaning memory...
setting up 32768 pointers...
chaseing pointers...
...done - 0x8104c968 - 0x8104c968
size: 65536, cycles: 1095575, loops: 32768, cycles_per_loop: 33
cleaning memory...
setting up 65536 pointers...
chaseing pointers...
...done - 0x8104a7a0 - 0x8104a7a0
size: 131072, cycles: 2213510, loops: 65536, cycles_per_loop: 33
cleaning memory...
setting up 131072 pointers...
chaseing pointers...
...done - 0x811eb308 - 0x811eb308
size: 262144, cycles: 4451866, loops: 131072, cycles_per_loop: 33
cleaning memory...
setting up 262144 pointers...
chaseing pointers...
...done - 0x811adf10 - 0x811adf10
size: 524288, cycles: 8924008, loops: 262144, cycles_per_loop: 34
cleaning memory...
setting up 524288 pointers...
chaseing pointers...
...done - 0x81181ab8 - 0x81181ab8
size: 1048576, cycles: 17867260, loops: 524288, cycles_per_loop: 34
cleaning memory...
setting up 1048576 pointers...
chaseing pointers...
...done - 0x81fa2870 - 0x81fa2870
size: 2097152, cycles: 35749656, loops: 1048576, cycles_per_loop: 34
cleaning memory...
setting up 2097152 pointers...
chaseing pointers...
...done - 0x81d4beb0 - 0x81d4beb0
size: 4194304, cycles: 71516485, loops: 2097152, cycles_per_loop: 34
cleaning memory...
setting up 4194304 pointers...
chaseing pointers...
...done - 0x81d31938 - 0x81d31938
size: 8388608, cycles: 143054469, loops: 4194304, cycles_per_loop: 34""",
    "Small Boom (16KB L1D)": """cleaning memory...
setting up 32 pointers...
chaseing pointers...
...done - 0x81000168 - 0x81000168
size: 64, cycles: 333, loops: 32, cycles_per_loop: 10
cleaning memory...
setting up 64 pointers...
chaseing pointers...
...done - 0x81000110 - 0x81000110
size: 128, cycles: 385, loops: 64, cycles_per_loop: 6
cleaning memory...
setting up 128 pointers...
chaseing pointers...
...done - 0x81000030 - 0x81000030
size: 256, cycles: 576, loops: 128, cycles_per_loop: 4
cleaning memory...
setting up 256 pointers...
chaseing pointers...
...done - 0x81000960 - 0x81000960
size: 512, cycles: 1108, loops: 256, cycles_per_loop: 4
cleaning memory...
setting up 512 pointers...
chaseing pointers...
...done - 0x810017f0 - 0x810017f0
size: 1024, cycles: 2355, loops: 512, cycles_per_loop: 4
cleaning memory...
setting up 1024 pointers...
chaseing pointers...
...done - 0x810020e8 - 0x810020e8
size: 2048, cycles: 6559, loops: 1024, cycles_per_loop: 6
cleaning memory...
setting up 2048 pointers...
chaseing pointers...
...done - 0x810045f0 - 0x810045f0
size: 4096, cycles: 43901, loops: 2048, cycles_per_loop: 21
cleaning memory...
setting up 4096 pointers...
chaseing pointers...
...done - 0x81006af8 - 0x81006af8
size: 8192, cycles: 116326, loops: 4096, cycles_per_loop: 28
cleaning memory...
setting up 8192 pointers...
chaseing pointers...
...done - 0x81015838 - 0x81015838
size: 16384, cycles: 260622, loops: 8192, cycles_per_loop: 31
cleaning memory...
setting up 16384 pointers...
chaseing pointers...
...done - 0x8100a360 - 0x8100a360
size: 32768, cycles: 549865, loops: 16384, cycles_per_loop: 33
cleaning memory...
setting up 32768 pointers...
chaseing pointers...
...done - 0x8104c968 - 0x8104c968
size: 65536, cycles: 1130473, loops: 32768, cycles_per_loop: 34
cleaning memory...
setting up 65536 pointers...
chaseing pointers...
...done - 0x8104a7a0 - 0x8104a7a0
size: 131072, cycles: 2286140, loops: 65536, cycles_per_loop: 34
cleaning memory...
setting up 131072 pointers...
chaseing pointers...
...done - 0x811eb308 - 0x811eb308
size: 262144, cycles: 4603646, loops: 131072, cycles_per_loop: 35
cleaning memory...
setting up 262144 pointers...
chaseing pointers...
...done - 0x811adf10 - 0x811adf10
size: 524288, cycles: 9232769, loops: 262144, cycles_per_loop: 35
cleaning memory...
setting up 524288 pointers...
chaseing pointers...
...done - 0x81181ab8 - 0x81181ab8
size: 1048576, cycles: 18493368, loops: 524288, cycles_per_loop: 35
cleaning memory...
setting up 1048576 pointers...
chaseing pointers...
...done - 0x81fa2870 - 0x81fa2870
size: 2097152, cycles: 37009522, loops: 1048576, cycles_per_loop: 35
cleaning memory...
setting up 2097152 pointers...
chaseing pointers...
...done - 0x81d4beb0 - 0x81d4beb0
size: 4194304, cycles: 74053102, loops: 2097152, cycles_per_loop: 35
cleaning memory...
setting up 4194304 pointers...
chaseing pointers...
...done - 0x81d31938 - 0x81d31938
size: 8388608, cycles: 148132652, loops: 4194304, cycles_per_loop: 35""",
    "Dual Small Boom (16KB L1D)": """cleaning memory...
setting up 32 pointers...
chaseing pointers...
...done - 0x81000168 - 0x81000168
size: 64, cycles: 344, loops: 32, cycles_per_loop: 10
cleaning memory...
setting up 64 pointers...
chaseing pointers...
...done - 0x81000110 - 0x81000110
size: 128, cycles: 385, loops: 64, cycles_per_loop: 6
cleaning memory...
setting up 128 pointers...
chaseing pointers...
...done - 0x81000030 - 0x81000030
size: 256, cycles: 589, loops: 128, cycles_per_loop: 4
cleaning memory...
setting up 256 pointers...
chaseing pointers...
...done - 0x81000960 - 0x81000960
size: 512, cycles: 1197, loops: 256, cycles_per_loop: 4
cleaning memory...
setting up 512 pointers...
chaseing pointers...
...done - 0x810017f0 - 0x810017f0
size: 1024, cycles: 2154, loops: 512, cycles_per_loop: 4
cleaning memory...
setting up 1024 pointers...
chaseing pointers...
...done - 0x810020e8 - 0x810020e8
size: 2048, cycles: 6688, loops: 1024, cycles_per_loop: 6
cleaning memory...
setting up 2048 pointers...
chaseing pointers...
...done - 0x810045f0 - 0x810045f0
size: 4096, cycles: 53470, loops: 2048, cycles_per_loop: 26
cleaning memory...
setting up 4096 pointers...
chaseing pointers...
...done - 0x81006af8 - 0x81006af8
size: 8192, cycles: 145468, loops: 4096, cycles_per_loop: 35
cleaning memory...
setting up 8192 pointers...
chaseing pointers...
...done - 0x81015838 - 0x81015838
size: 16384, cycles: 327432, loops: 8192, cycles_per_loop: 39
cleaning memory...
setting up 16384 pointers...
chaseing pointers...
...done - 0x8100a360 - 0x8100a360
size: 32768, cycles: 689326, loops: 16384, cycles_per_loop: 42
cleaning memory...
setting up 32768 pointers...
chaseing pointers...
...done - 0x8104c968 - 0x8104c968
size: 65536, cycles: 1420810, loops: 32768, cycles_per_loop: 43
cleaning memory...
setting up 65536 pointers...
chaseing pointers...
...done - 0x8104a7a0 - 0x8104a7a0
size: 131072, cycles: 2873875, loops: 65536, cycles_per_loop: 43
cleaning memory...
setting up 131072 pointers...
chaseing pointers...
...done - 0x811eb308 - 0x811eb308
size: 262144, cycles: 5788405, loops: 131072, cycles_per_loop: 44
cleaning memory...
setting up 262144 pointers...
chaseing pointers...
...done - 0x811adf10 - 0x811adf10
size: 524288, cycles: 11610604, loops: 262144, cycles_per_loop: 44
cleaning memory...
setting up 524288 pointers...
chaseing pointers...
...done - 0x81181ab8 - 0x81181ab8
size: 1048576, cycles: 23259062, loops: 524288, cycles_per_loop: 44
cleaning memory...
setting up 1048576 pointers...
chaseing pointers...
...done - 0x81fa2870 - 0x81fa2870
size: 2097152, cycles: 46543414, loops: 1048576, cycles_per_loop: 44
cleaning memory...
setting up 2097152 pointers...
chaseing pointers...
...done - 0x81d4beb0 - 0x81d4beb0
size: 4194304, cycles: 93105751, loops: 2097152, cycles_per_loop: 44
cleaning memory...
setting up 4194304 pointers...
chaseing pointers...
...done - 0x81d31938 - 0x81d31938
size: 8388608, cycles: 186282761, loops: 4194304, cycles_per_loop: 44""",
    "Rocket (16KB L1D, 512KB L2)": """cleaning memory...
setting up 32 pointers...
chaseing pointers...
...done - 0x81000168 - 0x81000168
size: 64, cycles: 147, loops: 32, cycles_per_loop: 4
cleaning memory...
setting up 64 pointers...
chaseing pointers...
...done - 0x81000110 - 0x81000110
size: 128, cycles: 203, loops: 64, cycles_per_loop: 3
cleaning memory...
setting up 128 pointers...
chaseing pointers...
...done - 0x81000030 - 0x81000030
size: 256, cycles: 395, loops: 128, cycles_per_loop: 3
cleaning memory...
setting up 256 pointers...
chaseing pointers...
...done - 0x81000960 - 0x81000960
size: 512, cycles: 779, loops: 256, cycles_per_loop: 3
cleaning memory...
setting up 512 pointers...
chaseing pointers...
...done - 0x810017f0 - 0x810017f0
size: 1024, cycles: 1613, loops: 512, cycles_per_loop: 3
cleaning memory...
setting up 1024 pointers...
chaseing pointers...
...done - 0x810020e8 - 0x810020e8
size: 2048, cycles: 5047, loops: 1024, cycles_per_loop: 4
cleaning memory...
setting up 2048 pointers...
chaseing pointers...
...done - 0x810045f0 - 0x810045f0
size: 4096, cycles: 26772, loops: 2048, cycles_per_loop: 13
cleaning memory...
setting up 4096 pointers...
chaseing pointers...
...done - 0x81006af8 - 0x81006af8
size: 8192, cycles: 65694, loops: 4096, cycles_per_loop: 16
cleaning memory...
setting up 8192 pointers...
chaseing pointers...
...done - 0x81015838 - 0x81015838
size: 16384, cycles: 143047, loops: 8192, cycles_per_loop: 17
cleaning memory...
setting up 16384 pointers...
chaseing pointers...
...done - 0x8100a360 - 0x8100a360
size: 32768, cycles: 299066, loops: 16384, cycles_per_loop: 18
cleaning memory...
setting up 32768 pointers...
chaseing pointers...
...done - 0x8104c968 - 0x8104c968
size: 65536, cycles: 673032, loops: 32768, cycles_per_loop: 20
cleaning memory...
setting up 65536 pointers...
chaseing pointers...
...done - 0x8104a7a0 - 0x8104a7a0
size: 131072, cycles: 2197578, loops: 65536, cycles_per_loop: 33
cleaning memory...
setting up 131072 pointers...
chaseing pointers...
...done - 0x811eb308 - 0x811eb308
size: 262144, cycles: 5360410, loops: 131072, cycles_per_loop: 40
cleaning memory...
setting up 262144 pointers...
chaseing pointers...
...done - 0x811adf10 - 0x811adf10
size: 524288, cycles: 11740561, loops: 262144, cycles_per_loop: 44
cleaning memory...
setting up 524288 pointers...
chaseing pointers...
...done - 0x81181ab8 - 0x81181ab8
size: 1048576, cycles: 24738103, loops: 524288, cycles_per_loop: 47
cleaning memory...
setting up 1048576 pointers...
chaseing pointers...
...done - 0x81fa2870 - 0x81fa2870
size: 2097152, cycles: 50904095, loops: 1048576, cycles_per_loop: 48
cleaning memory...
setting up 2097152 pointers...
chaseing pointers...
...done - 0x81d4beb0 - 0x81d4beb0
size: 4194304, cycles: 103314272, loops: 2097152, cycles_per_loop: 49
cleaning memory...
setting up 4194304 pointers...
chaseing pointers...
...done - 0x81d31938 - 0x81d31938
size: 8388608, cycles: 208166844, loops: 4194304, cycles_per_loop: 49""",
    "Small Boom (16KB L1D, 512KB L2)": """cleaning memory...
setting up 32 pointers...
chaseing pointers...
...done - 0x81000168 - 0x81000168
size: 64, cycles: 283, loops: 32, cycles_per_loop: 8
cleaning memory...
setting up 64 pointers...
chaseing pointers...
...done - 0x81000110 - 0x81000110
size: 128, cycles: 385, loops: 64, cycles_per_loop: 6
cleaning memory...
setting up 128 pointers...
chaseing pointers...
...done - 0x81000030 - 0x81000030
size: 256, cycles: 582, loops: 128, cycles_per_loop: 4
cleaning memory...
setting up 256 pointers...
chaseing pointers...
...done - 0x81000960 - 0x81000960
size: 512, cycles: 1164, loops: 256, cycles_per_loop: 4
cleaning memory...
setting up 512 pointers...
chaseing pointers...
...done - 0x810017f0 - 0x810017f0
size: 1024, cycles: 2214, loops: 512, cycles_per_loop: 4
cleaning memory...
setting up 1024 pointers...
chaseing pointers...
...done - 0x810020e8 - 0x810020e8
size: 2048, cycles: 5171, loops: 1024, cycles_per_loop: 5
cleaning memory...
setting up 2048 pointers...
chaseing pointers...
...done - 0x810045f0 - 0x810045f0
size: 4096, cycles: 28639, loops: 2048, cycles_per_loop: 13
cleaning memory...
setting up 4096 pointers...
chaseing pointers...
...done - 0x81006af8 - 0x81006af8
size: 8192, cycles: 73906, loops: 4096, cycles_per_loop: 18
cleaning memory...
setting up 8192 pointers...
chaseing pointers...
...done - 0x81015838 - 0x81015838
size: 16384, cycles: 162783, loops: 8192, cycles_per_loop: 19
cleaning memory...
setting up 16384 pointers...
chaseing pointers...
...done - 0x8100a360 - 0x8100a360
size: 32768, cycles: 339731, loops: 16384, cycles_per_loop: 20
cleaning memory...
setting up 32768 pointers...
chaseing pointers...
...done - 0x8104c968 - 0x8104c968
size: 65536, cycles: 766438, loops: 32768, cycles_per_loop: 23
cleaning memory...
setting up 65536 pointers...
chaseing pointers...
...done - 0x8104a7a0 - 0x8104a7a0
size: 131072, cycles: 2455013, loops: 65536, cycles_per_loop: 37
cleaning memory...
setting up 131072 pointers...
chaseing pointers...
...done - 0x811eb308 - 0x811eb308
size: 262144, cycles: 5923739, loops: 131072, cycles_per_loop: 45
cleaning memory...
setting up 262144 pointers...
chaseing pointers...
...done - 0x811adf10 - 0x811adf10
size: 524288, cycles: 12803436, loops: 262144, cycles_per_loop: 48
cleaning memory...
setting up 524288 pointers...
chaseing pointers...
...done - 0x81181ab8 - 0x81181ab8
size: 1048576, cycles: 26532261, loops: 524288, cycles_per_loop: 50
cleaning memory...
setting up 1048576 pointers...
chaseing pointers...
...done - 0x81fa2870 - 0x81fa2870
size: 2097152, cycles: 53985677, loops: 1048576, cycles_per_loop: 51
cleaning memory...
setting up 2097152 pointers...
chaseing pointers...
...done - 0x81d4beb0 - 0x81d4beb0
size: 4194304, cycles: 108891798, loops: 2097152, cycles_per_loop: 51
cleaning memory...
setting up 4194304 pointers...
chaseing pointers...
...done - 0x81d31938 - 0x81d31938
size: 8388608, cycles: 218680150, loops: 4194304, cycles_per_loop: 52""",
    "Dual Small Boom (16KB L1D, 512KB L2)": """cleaning memory...
setting up 32 pointers...
chaseing pointers...
...done - 0x81000168 - 0x81000168
size: 64, cycles: 306, loops: 32, cycles_per_loop: 9
cleaning memory...
setting up 64 pointers...
chaseing pointers...
...done - 0x81000110 - 0x81000110
size: 128, cycles: 385, loops: 64, cycles_per_loop: 6
cleaning memory...
setting up 128 pointers...
chaseing pointers...
...done - 0x81000030 - 0x81000030
size: 256, cycles: 605, loops: 128, cycles_per_loop: 4
cleaning memory...
setting up 256 pointers...
chaseing pointers...
...done - 0x81000960 - 0x81000960
size: 512, cycles: 1164, loops: 256, cycles_per_loop: 4
cleaning memory...
setting up 512 pointers...
chaseing pointers...
...done - 0x810017f0 - 0x810017f0
size: 1024, cycles: 2315, loops: 512, cycles_per_loop: 4
cleaning memory...
setting up 1024 pointers...
chaseing pointers...
...done - 0x810020e8 - 0x810020e8
size: 2048, cycles: 5787, loops: 1024, cycles_per_loop: 5
cleaning memory...
setting up 2048 pointers...
chaseing pointers...
...done - 0x810045f0 - 0x810045f0
size: 4096, cycles: 28857, loops: 2048, cycles_per_loop: 14
cleaning memory...
setting up 4096 pointers...
chaseing pointers...
...done - 0x81006af8 - 0x81006af8
size: 8192, cycles: 73986, loops: 4096, cycles_per_loop: 18
cleaning memory...
setting up 8192 pointers...
chaseing pointers...
...done - 0x81015838 - 0x81015838
size: 16384, cycles: 161977, loops: 8192, cycles_per_loop: 19
cleaning memory...
setting up 16384 pointers...
chaseing pointers...
...done - 0x8100a360 - 0x8100a360
size: 32768, cycles: 339737, loops: 16384, cycles_per_loop: 20
cleaning memory...
setting up 32768 pointers...
chaseing pointers...
...done - 0x8104c968 - 0x8104c968
size: 65536, cycles: 764449, loops: 32768, cycles_per_loop: 23
cleaning memory...
setting up 65536 pointers...
chaseing pointers...
...done - 0x8104a7a0 - 0x8104a7a0
size: 131072, cycles: 2454908, loops: 65536, cycles_per_loop: 37
cleaning memory...
setting up 131072 pointers...
chaseing pointers...
...done - 0x811eb308 - 0x811eb308
size: 262144, cycles: 5927774, loops: 131072, cycles_per_loop: 45
cleaning memory...
setting up 262144 pointers...
chaseing pointers...
...done - 0x811adf10 - 0x811adf10
size: 524288, cycles: 12800386, loops: 262144, cycles_per_loop: 48
cleaning memory...
setting up 524288 pointers...
chaseing pointers...
...done - 0x81181ab8 - 0x81181ab8
size: 1048576, cycles: 26535982, loops: 524288, cycles_per_loop: 50
cleaning memory...
setting up 1048576 pointers...
chaseing pointers...
...done - 0x81fa2870 - 0x81fa2870
size: 2097152, cycles: 53978980, loops: 1048576, cycles_per_loop: 51
cleaning memory...
setting up 2097152 pointers...
chaseing pointers...
...done - 0x81d4beb0 - 0x81d4beb0
size: 4194304, cycles: 108897882, loops: 2097152, cycles_per_loop: 51
cleaning memory...
setting up 4194304 pointers...
chaseing pointers...
...done - 0x81d31938 - 0x81d31938
size: 8388608, cycles: 218686012, loops: 4194304, cycles_per_loop: 52""",
}
fig = plt.figure(figsize=(8,5))
for name, text in texts.items():
    xs = []
    ys = []
    for line in text.split("\n"):
        if "size" not in line:
            continue
        line = line.replace(":", "").split(",")
        d = dict(pair.split() for pair in line)
        xs.append(int(d["size"])*8)
        ys.append(int(d["cycles"])/int(d["loops"]))
    plt.plot(range(len(xs)), ys, label=name)
plt.title("pointer chasing latency")
ax = plt.gca()
ax.set_xticks(range(len(xs)))
ax.set_xticklabels(xs)
plt.xticks(rotation=45)
ax.set_ylabel("cycles per iteration")
ax.set_xlabel("memory size (bytes)")
plt.legend()
fig.tight_layout()
plt.savefig(f"pointer_chasing_latency.pdf", bbox_inches='tight')
plt.show()